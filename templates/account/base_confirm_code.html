{% extends "account/base_entrance.html" %}
{% load i18n static allauth account %}

{% block head_title %}
    {{ block.super }}
{% endblock head_title %}

{% block left_content %}
<div class="auth-left">
    <img src="{% static 'auth/images/code_verification.svg' %}" 
         alt="Code Verification" 
         class="auth-illustration">

    <h1>{% block title %}{% endblock %}</h1>

    <p>
        {% trans "We've sent a code to" %}
        {% block recipient %}{% endblock %}
        . {% trans "The code expires shortly, so please enter it soon." %}
    </p>
</div>
{% endblock left_content %}

{% block right_content %}
<div class="auth-right">

    <!-- Verification Form -->
    <form method="post" action="{{ form_action }}" class="auth-form">
        {% csrf_token %}
        {% if verify_form %}
            {% for field in verify_form %}
                <div class="auth-form-group">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.errors %}
                        <div class="auth-error">{{ field.errors|striptags }}</div>
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}
        {{ redirect_field }}

        <div class="auth-alt-actions">
            <button type="submit" class="btn-primary btn-full">
                {% translate "Confirm" %}
            </button>

            {% if can_resend %}
            <button form="resend" class="btn-outline btn-full">
                {% translate "Request new code" %}
            </button>
            {% endif %}

            {% if cancel_url %}
            <a href="{{ cancel_url }}" class="btn-outline btn-full">
                {% translate "Cancel" %}
            </a>
            {% else %}
            <button type="submit" form="logout-from-stage" class="btn-outline btn-full">
                {% translate "Cancel" %}
            </button>
            {% endif %}
        </div>
    </form>

    {% if can_resend %}
    <form id="resend" method="post" action="{{ form_action }}">
        <input type="hidden" name="action" value="resend">
        {% csrf_token %}
    </form>
    {% endif %}

    {% if not cancel_url %}
    <form id="logout-from-stage" method="post" action="{% url 'account_logout' %}">
        <input type="hidden" name="next" value="{% url 'account_login' %}">
        {% csrf_token %}
    </form>
    {% endif %}

    {% if can_change %}
    <details {% if change_form.errors %}open{% endif %}>
        <summary>{% block change_title %}{% endblock %}</summary>
        <form method="post" action="{{ form_action }}" class="auth-form">
            {% csrf_token %}
            {% for field in change_form %}
                <div class="auth-form-group">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.errors %}
                        <div class="auth-error">{{ field.errors|striptags }}</div>
                    {% endif %}
                </div>
            {% endfor %}
            <button type="submit" name="action" value="change" class="btn-primary btn-full">
                {% translate "Change" %}
            </button>
        </form>
    </details>
    {% endif %}

</div>
{% endblock right_content %}
